# HTTP 缓存

HTTP 缓存适用于临时存储（缓存）Web 文档（如 HTML 页面和图像），以减少服务器延迟的一种信息技术。
一个优秀的缓存策略可以缩短网页请求资源的距离，减少延迟，并且由于缓存文件可以重复利用，因此可以减少带宽，降低网络负荷。

### 按缓存位置分类

- 内存缓存（memory cache）
- 磁盘缓存（disk cache）
- service worker

### 浏览器资源缓存分类

- 磁盘缓存
- 内存缓存

### 按次元缓存策略分类

- 强缓存
  - 强缓存都是由本地浏览器在确定是否使用缓存，当浏览器没有命中强缓存时就会向服务器发送请求，验证协商缓存是否命中，如果缓存命中则返回 304 状态码，否则返回新的资源数据。
  - Expires （http 1.0）
  - Cache-control （http 1.1 - no-cache（储存在本地缓存区中，只是在与原始服务器进行新鲜度再验证之前，缓存不能将其提供给客户端使用） - max-age （例如值为 3600，表示（当前时间+3600 秒）内不与服务器请求新的数据资源
    ） - s-maxage（和 max-age 一样，但这个是设定代理服务器的缓存时间
    ） - no-store （不缓存任何数据） - public（所有内容都将被缓存(客户端和代理服务器都可缓存)
    ） - private（内容只缓存到私有缓存中(仅客户端可以缓存，代理服务器不可缓存)
    ）
- 协商缓存
  - 商缓存（也叫对比缓存）是由服务器来确定资源是否可用，这将涉及到两组字段成对出现的，在浏览器第一次发出请求时会带上字段（Last-Modified 或者 Etag），则后续请求则会带上对于的请求字段（if-modified-since 或者 if-none-Match），若响应头没有 Last-Modified 或者 Etag，则请求头也不会有对应的字段
  - Etag
    - Etag（是一个文件的唯一标识符，当资源发生变化时这个 ETag 就会发生变化。弥补了上面 last-modified 可能出现文件内容没有变化但是 last-modified 发生了变化出现重新向服务器请求资源情况。这个值也是又服务器返回的）
    - If-None-Match（是浏览器请求数据时带上的字段，值是上次服务器返回的 ETag）
  - Last-modified
    - Last-Modified（表示本地文件最后修改时间，由服务器返回）
    - If-Modified-Since（是浏览器在请求数据时返回的，值是上次浏览器返回的 Last-modified）

`缓存的核心就是解决什么时候缓存、什么时候更新缓存的问题`

```
强制缓存的优先级最高，清切在缓存有效期内浏览器不会应为资源的改动而发送请求，因此强制缓存的使用适用于大型且不易修改的资源文件，例如，第三方的CSS/JS/图片资源。如果想提高缓存的灵活性，也可以为文件名加上 hash 标识来进行版本的区分。
```

```
协商缓存灵活性搞，适用于数据的缓存
```

#### 为什么大厂都不怎么用 Etag?

```
大厂多使用负载均衡的方式来调度 HTTP 请求。因此，同一个客户端对同一个页面的多次请求很可能被分配到不同的服务器来响应，而根据 Etag 的计算原理，不同的服务器有可能在资源内容没有变化的情况下，计算出不一样的 etag，从而使缓存失效
```

![协商缓存](https://qw-album.imeduplus.com/muwa/assets/test/%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98.png)

[HTTP 中的强缓存与协商缓存
](https://juejin.cn/post/7101942484543995934#comment)
